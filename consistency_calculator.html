<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Prop Firm Consistency Rule Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background: linear-gradient(
          135deg,
          #0a0a0a 0%,
          #1a1a1a 50%,
          #0a0a0a 100%
        );
        min-height: 100vh;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial,
          sans-serif;
      }

      .glass {
        background: rgba(13, 17, 23, 0.7);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(48, 54, 61, 0.5);
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
      }

      .glass-light {
        background: rgba(22, 27, 34, 0.6);
        backdrop-filter: blur(8px);
        border: 1px solid rgba(48, 54, 61, 0.3);
      }

      input[type="number"] {
        -moz-appearance: textfield;
      }

      input[type="number"]::-webkit-outer-spin-button,
      input[type="number"]::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }

      /* Slider styling */
      input[type="range"] {
        -webkit-appearance: none;
        width: 100%;
        height: 8px;
        border-radius: 5px;
        background: rgba(48, 54, 61, 0.5);
        outline: none;
      }

      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #20bf6b;
        cursor: pointer;
        box-shadow: 0 0 10px rgba(32, 191, 107, 0.5);
      }

      input[type="range"]::-moz-range-thumb {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #20bf6b;
        cursor: pointer;
        border: none;
        box-shadow: 0 0 10px rgba(32, 191, 107, 0.5);
      }

      /* Toggle switch CSS */
      .toggle-container {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .toggle-switch {
        position: relative;
        width: 280px;
        height: 50px;
        background: rgba(22, 27, 34, 0.8);
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 2px solid rgba(48, 54, 61, 0.5);
        display: flex;
        align-items: center;
        padding: 4px;
      }

      .toggle-labels {
        position: absolute;
        width: 100%;
        display: flex;
        justify-content: space-between;
        padding: 0 30px;
        pointer-events: none;
        z-index: 1;
      }

      .toggle-label {
        font-size: 14px;
        font-weight: 600;
        transition: all 0.3s ease;
        color: rgba(255, 255, 255, 0.4);
      }

      .toggle-label.active {
        color: #000;
      }

      .toggle-slider {
        position: absolute;
        width: 48%;
        height: 42px;
        background: linear-gradient(135deg, #20bf6b 0%, #1a9957 100%);
        border-radius: 21px;
        transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        left: 4px;
        box-shadow: 0 4px 12px rgba(32, 191, 107, 0.4);
      }

      .toggle-switch.aggressive .toggle-slider {
        left: calc(52% - 4px);
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        box-shadow: 0 4px 12px rgba(52, 152, 219, 0.4);
      }

      .btn-primary {
        background: linear-gradient(135deg, #20bf6b 0%, #1a9957 100%);
        transition: all 0.3s ease;
      }

      .btn-primary:hover {
        background: linear-gradient(135deg, #1a9957 0%, #20bf6b 100%);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(32, 191, 107, 0.3);
      }

      .result-card {
        transition: all 0.3s ease;
      }

      .result-card:hover {
        transform: translateY(-2px);
      }

      /* Warning banner */
      .warning-banner {
        animation: slideIn 0.5s ease-out;
      }

      @keyframes slideIn {
        from {
          transform: translateY(-20px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      ::-webkit-scrollbar {
        width: 8px;
      }

      ::-webkit-scrollbar-track {
        background: rgba(13, 17, 23, 0.5);
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb {
        background: rgba(48, 54, 61, 0.8);
        border-radius: 4px;
      }

      .pulse {
        animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.7;
        }
      }
    </style>
  </head>
  <body class="p-4 md:p-6">
    <div class="max-w-6xl mx-auto">
      <!-- Header -->
      <header class="glass rounded-xl p-6 mb-6">
        <h1
          class="text-3xl md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-emerald-500"
        >
          Consistency Rule Calculator
        </h1>
        <p class="text-gray-400 mt-2">
          Calculate your prop firm consistency rule compliance and trading days
          projection
        </p>
      </header>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Left Side: Input Form -->
        <div class="glass rounded-xl p-6">
          <h2 class="text-2xl font-bold text-green-400 mb-6">
            Account Details
          </h2>

          <form id="calculatorForm" class="space-y-6">
            <!-- Account Size -->
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">
                Account Size ($)
              </label>
              <input
                type="number"
                id="accountSize"
                required
                step="0.01"
                value="5000"
                placeholder="e.g., 5000"
                class="w-full bg-black bg-opacity-50 border border-gray-700 rounded-lg px-4 py-3 text-gray-200 focus:outline-none focus:border-green-500 transition-colors text-lg"
              />
            </div>

            <!-- Payout Amount -->
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">
                Payout Amount ($)
              </label>
              <input
                type="number"
                id="payoutAmount"
                required
                step="0.01"
                value="500"
                placeholder="e.g., 500"
                class="w-full bg-black bg-opacity-50 border border-gray-700 rounded-lg px-4 py-3 text-gray-200 focus:outline-none focus:border-green-500 transition-colors text-lg"
              />
            </div>

            <!-- Payout Cycle Slider -->
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">
                Payout Cycle:
                <span id="payoutCycleValue" class="text-green-400 font-bold"
                  >15</span
                >
                days
              </label>
              <input
                type="range"
                id="payoutCycle"
                min="1"
                max="30"
                value="15"
                class="w-full"
              />
              <div class="flex justify-between text-xs text-gray-500 mt-1">
                <span>1 day</span>
                <span>30 days</span>
              </div>
            </div>

            <!-- Consistency % Slider -->
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">
                Consistency Rule:
                <span id="consistencyValue" class="text-green-400 font-bold"
                  >35</span
                >%
              </label>
              <input
                type="range"
                id="consistencyPercent"
                min="15"
                max="65"
                value="35"
                class="w-full"
              />
              <div class="flex justify-between text-xs text-gray-500 mt-1">
                <span>15%</span>
                <span>65%</span>
              </div>
            </div>

            <!-- Min Trading Days Slider -->
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">
                Trading Days:
                <span id="minDaysValue" class="text-green-400 font-bold"
                  >5</span
                >
                days
              </label>
              <input
                type="range"
                id="minTradingDays"
                min="1"
                max="15"
                value="5"
                class="w-full"
              />
              <div class="flex justify-between text-xs text-gray-500 mt-1">
                <span>1 day</span>
                <span>15 days</span>
              </div>
            </div>

            <!-- Mode Toggle -->
            <div>
              <label
                class="block text-sm font-medium text-gray-300 mb-3 text-center"
              >
                Trading Mode
              </label>
              <div class="toggle-container">
                <div
                  id="modeToggle"
                  class="toggle-switch"
                  onclick="toggleMode()"
                >
                  <div class="toggle-slider"></div>
                  <div class="toggle-labels">
                    <span class="toggle-label active" id="normalLabel"
                      >NORMAL</span
                    >
                    <span class="toggle-label" id="aggressiveLabel"
                      >AGGRESSIVE</span
                    >
                  </div>
                </div>
              </div>
              <div class="flex justify-between text-xs text-gray-400 mt-2 px-8">
                <span>Relaxed</span>
                <span>Fast Payout</span>
              </div>
            </div>

            <button
              type="submit"
              class="w-full btn-primary text-white py-3 rounded-lg font-semibold text-lg"
            >
              Calculate
            </button>
          </form>
        </div>

        <!-- Right Side: Results & Chart -->
        <div class="glass rounded-xl p-6">
          <h2 class="text-2xl font-bold text-green-400 mb-6">
            Results & Projection
          </h2>

          <!-- Warning Banner -->
          <div id="warningBanner" class="hidden warning-banner mb-6">
            <div class="glass-light rounded-lg p-4 border-l-4 border-red-500">
              <div class="flex items-start gap-3">
                <svg
                  class="w-6 h-6 text-red-500 mt-0.5 flex-shrink-0"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
                  ></path>
                </svg>
                <div>
                  <h3 class="text-red-400 font-semibold mb-2">
                    ‚ö†Ô∏è Consistency Rule Violation
                  </h3>
                  <div class="text-sm text-gray-300" id="warningMessage"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Results Section -->
          <div id="resultsSection" class="hidden">
            <!-- Normal Mode Results -->
            <div id="normalResults" class="space-y-4">
              <div class="grid grid-cols-2 gap-4">
                <div class="glass-light rounded-lg p-4 result-card">
                  <p class="text-xs text-gray-400 mb-1">Trading Days</p>
                  <p
                    class="text-2xl font-bold text-green-400"
                    id="normalTradingDays"
                  >
                    0
                  </p>
                  <p class="text-xs text-green-300 mt-1" id="normalDaysPercent">
                    0%
                  </p>
                </div>
                <div class="glass-light rounded-lg p-4 result-card">
                  <p class="text-xs text-gray-400 mb-1">Daily Target</p>
                  <p
                    class="text-2xl font-bold text-green-400"
                    id="normalDailyTarget"
                  >
                    $0
                  </p>
                  <p
                    class="text-xs text-green-300 mt-1"
                    id="normalDailyPercent"
                  >
                    0%
                  </p>
                </div>
              </div>
            </div>

            <!-- Aggressive Mode Results -->
            <div id="aggressiveResults" class="hidden space-y-4">
              <div class="grid grid-cols-2 gap-4">
                <div class="glass-light rounded-lg p-4 result-card">
                  <p class="text-xs text-gray-400 mb-1">Best Day Profit</p>
                  <p
                    class="text-2xl font-bold text-green-400"
                    id="bestDayProfit"
                  >
                    $0
                  </p>
                  <p class="text-xs text-green-300 mt-1" id="bestDayPercent">
                    0%
                  </p>
                  <p
                    class="text-xs text-gray-400 mt-1"
                    id="bestDayProfitPercent"
                  >
                    0%
                  </p>
                </div>
                <div class="glass-light rounded-lg p-4 result-card">
                  <p class="text-xs text-gray-400 mb-1">Other Days (each)</p>
                  <p
                    class="text-2xl font-bold text-blue-400"
                    id="otherDaysProfit"
                  >
                    $0
                  </p>
                  <p class="text-xs text-blue-300 mt-1" id="otherDaysPercent">
                    0%
                  </p>
                  <p
                    class="text-xs text-gray-400 mt-1"
                    id="otherDaysProfitPercent"
                  >
                    0%
                  </p>
                </div>
                <div class="glass-light rounded-lg p-4 result-card">
                  <p class="text-xs text-gray-400 mb-1">Trading Days</p>
                  <p
                    class="text-2xl font-bold text-blue-400"
                    id="aggressiveTradingDays"
                  >
                    0
                  </p>
                  <p
                    class="text-xs text-blue-300 mt-1"
                    id="aggressiveDaysPercent"
                  >
                    0%
                  </p>
                </div>
                <div class="glass-light rounded-lg p-4 result-card">
                  <p class="text-xs text-gray-400 mb-1">Days Saved</p>
                  <p class="text-2xl font-bold text-blue-400" id="daysSaved">
                    0
                  </p>
                  <p class="text-xs text-blue-300 mt-1" id="daysSavedPercent">
                    0%
                  </p>
                </div>
              </div>
            </div>

            <!-- Pie Chart -->
            <div class="glass-light rounded-lg p-6 mt-6">
              <h3 class="text-lg font-semibold text-green-300 mb-4 text-center">
                Trading Days Projection
              </h3>
              <div class="flex justify-center">
                <canvas id="projectionChart" width="300" height="300"></canvas>
              </div>
            </div>

            <!-- Breakdown -->
            <div class="glass-light rounded-lg p-4 mt-6">
              <h3 class="text-sm font-semibold text-green-400 mb-3">
                üìä Summary
              </h3>
              <div
                class="space-y-2 text-sm text-gray-300"
                id="summaryContent"
              ></div>
            </div>
          </div>

          <!-- Placeholder -->
          <div
            id="placeholder"
            class="flex flex-col items-center justify-center h-96 text-center"
          >
            <div class="text-6xl mb-4 pulse">üìä</div>
            <p class="text-gray-400 text-lg">Configure your settings</p>
            <p class="text-gray-500 text-sm mt-2">
              Adjust sliders and click Calculate
            </p>
          </div>
        </div>
      </div>
    </div>

    <script>
      let currentMode = "normal";

      // Update slider values in real-time
      document
        .getElementById("payoutCycle")
        .addEventListener("input", function (e) {
          document.getElementById("payoutCycleValue").textContent =
            e.target.value;
        });

      document
        .getElementById("consistencyPercent")
        .addEventListener("input", function (e) {
          document.getElementById("consistencyValue").textContent =
            e.target.value;
        });

      document
        .getElementById("minTradingDays")
        .addEventListener("input", function (e) {
          document.getElementById("minDaysValue").textContent = e.target.value;
        });

      // Toggle mode
      function toggleMode() {
        const toggle = document.getElementById("modeToggle");
        const normalLabel = document.getElementById("normalLabel");
        const aggressiveLabel = document.getElementById("aggressiveLabel");

        if (currentMode === "normal") {
          currentMode = "aggressive";
          toggle.classList.add("aggressive");
          normalLabel.classList.remove("active");
          aggressiveLabel.classList.add("active");
        } else {
          currentMode = "normal";
          toggle.classList.remove("aggressive");
          normalLabel.classList.add("active");
          aggressiveLabel.classList.remove("active");
        }
      }

      // Form submission
      document
        .getElementById("calculatorForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          calculateConsistency();
        });

      function calculateConsistency() {
        // Get input values
        const accountSize = parseFloat(
          document.getElementById("accountSize").value
        );
        const payoutAmount = parseFloat(
          document.getElementById("payoutAmount").value
        );
        const payoutCycle = parseInt(
          document.getElementById("payoutCycle").value
        );
        const consistencyPercent = parseInt(
          document.getElementById("consistencyPercent").value
        );
        const minTradingDays = parseInt(
          document.getElementById("minTradingDays").value
        );

        // Validate basic inputs
        if (isNaN(accountSize) || isNaN(payoutAmount)) {
          alert("Please enter valid numbers");
          return;
        }

        if (payoutAmount > accountSize) {
          alert("Payout amount cannot exceed account size");
          return;
        }

        // Hide placeholder
        document.getElementById("placeholder").classList.add("hidden");

        if (currentMode === "normal") {
          showNormalResults(
            accountSize,
            payoutAmount,
            payoutCycle,
            consistencyPercent
          );
        } else {
          showAggressiveResults(
            accountSize,
            payoutAmount,
            payoutCycle,
            consistencyPercent,
            minTradingDays
          );
        }
      }

      function showNormalResults(
        accountSize,
        payoutAmount,
        payoutCycle,
        consistencyPercent
      ) {
        // Calculate
        const dailyTarget = payoutAmount / payoutCycle;
        const maxAllowed = payoutAmount * (consistencyPercent / 100);
        const dailyPercent = (dailyTarget / accountSize) * 100;

        // PRIORITY: Validate against consistency rule
        if (dailyTarget > maxAllowed) {
          // Calculate minimum days needed
          const minDaysNeeded = Math.ceil(payoutAmount / maxAllowed);
          const requiredConsistency = Math.ceil(
            (dailyTarget / payoutAmount) * 100
          );
          const maxPayoutPossible = (maxAllowed * payoutCycle).toFixed(2);

          document.getElementById("warningMessage").innerHTML = `
                    <strong>Cannot achieve payout with current settings!</strong><br><br>
                    <div class="space-y-2">
                        <div>üìä <strong>Current Setup:</strong></div>
                        <div class="ml-4">
                            ‚Ä¢ Daily Target: <strong>$${dailyTarget.toFixed(
                              2
                            )}</strong> (${(
            (dailyTarget / payoutAmount) *
            100
          ).toFixed(1)}% of payout)<br>
                            ‚Ä¢ Max Allowed: <strong>$${maxAllowed.toFixed(
                              2
                            )}</strong> (${consistencyPercent}% consistency rule)<br>
                            ‚Ä¢ Payout Cycle: <strong>${payoutCycle} days</strong>
                        </div>

                        <div class="mt-3">üéØ <strong>Minimum Trading Days Needed: ${minDaysNeeded} days</strong></div>

                        <div class="mt-3">‚úÖ <strong>Choose One Solution:</strong></div>
                        <div class="ml-4">
                            1. Increase Payout Cycle to <strong>${minDaysNeeded}+ days</strong><br>
                            2. Increase Consistency % to <strong>${requiredConsistency}%+</strong><br>
                            3. Switch to <strong>AGGRESSIVE</strong> mode<br>
                            4. Reduce Payout Amount to <strong>$${maxPayoutPossible}</strong> or less
                        </div>
                    </div>
                `;

          document.getElementById("warningBanner").classList.remove("hidden");
          document.getElementById("resultsSection").classList.add("hidden");
          return;
        }

        // Hide warning and show results
        document.getElementById("warningBanner").classList.add("hidden");
        document.getElementById("normalResults").classList.remove("hidden");
        document.getElementById("aggressiveResults").classList.add("hidden");
        document.getElementById("resultsSection").classList.remove("hidden");

        // Update UI
        document.getElementById("normalTradingDays").textContent = payoutCycle;
        document.getElementById("normalDaysPercent").textContent =
          "100% of cycle";
        document.getElementById("normalDailyTarget").textContent =
          "$" + dailyTarget.toFixed(2);
        document.getElementById("normalDailyPercent").textContent =
          dailyPercent.toFixed(3) + "% of account";

        // Summary
        const summary = `
                <div class="flex justify-between">
                    <span>Mode:</span>
                    <span class="font-semibold text-green-400">Normal (Relaxed)</span>
                </div>
                <div class="flex justify-between">
                    <span>Total Days:</span>
                    <span class="font-semibold">${payoutCycle} days</span>
                </div>
                <div class="flex justify-between">
                    <span>Daily Target:</span>
                    <span class="font-semibold">$${dailyTarget.toFixed(
                      2
                    )}</span>
                </div>
                <div class="flex justify-between">
                    <span>Consistency Check:</span>
                    <span class="font-semibold text-green-400">‚úì Pass (${consistencyPercent}%)</span>
                </div>
                <div class="flex justify-between">
                    <span>Total Payout:</span>
                    <span class="font-semibold text-green-400">$${payoutAmount.toFixed(
                      2
                    )}</span>
                </div>
            `;
        document.getElementById("summaryContent").innerHTML = summary;

        // Draw chart
        drawPieChart(
          payoutCycle,
          dailyTarget,
          dailyTarget,
          accountSize,
          "NORMAL"
        );
      }

      function showAggressiveResults(
        accountSize,
        payoutAmount,
        payoutCycle,
        consistencyPercent,
        minTradingDays
      ) {
        // Calculate max daily allowed based on consistency rule
        const maxAllowed = payoutAmount * (consistencyPercent / 100);

        // PRIORITY: Validate against consistency rule
        const minDaysNeeded = Math.ceil(payoutAmount / maxAllowed);

        if (minTradingDays < minDaysNeeded) {
          // Show warning
          const requiredConsistency = Math.ceil((1 / minTradingDays) * 100);
          const maxPayoutPossible = (maxAllowed * minTradingDays).toFixed(2);

          document.getElementById("warningMessage").innerHTML = `
                    <strong>Cannot achieve payout in ${minTradingDays} day(s)!</strong><br><br>
                    <div class="space-y-2">
                        <div>üìä <strong>Current Setup:</strong></div>
                        <div class="ml-4">
                            ‚Ä¢ Payout Target: <strong>$${payoutAmount.toFixed(
                              2
                            )}</strong><br>
                            ‚Ä¢ Max per Day: <strong>$${maxAllowed.toFixed(
                              2
                            )}</strong> (${consistencyPercent}% rule)<br>
                            ‚Ä¢ Min Trading Days: <strong>${minTradingDays} days</strong>
                        </div>

                        <div class="mt-3">üéØ <strong>Minimum Trading Days Needed: ${minDaysNeeded} days</strong></div>

                        <div class="mt-3">‚úÖ <strong>Choose One Solution:</strong></div>
                        <div class="ml-4">
                            1. Increase Min Trading Days to <strong>${minDaysNeeded}+ days</strong><br>
                            2. Increase Consistency % to <strong>${requiredConsistency}%+</strong><br>
                            3. Reduce Payout Amount to <strong>$${maxPayoutPossible}</strong> or less<br>
                            4. Switch to <strong>NORMAL</strong> mode with longer cycle
                        </div>
                    </div>
                `;

          document.getElementById("warningBanner").classList.remove("hidden");
          document.getElementById("resultsSection").classList.add("hidden");
          return;
        }

        // Hide warning and show results
        document.getElementById("warningBanner").classList.add("hidden");
        document.getElementById("normalResults").classList.add("hidden");
        document.getElementById("aggressiveResults").classList.remove("hidden");
        document.getElementById("resultsSection").classList.remove("hidden");

        // Calculate distribution
        const bestDay = payoutAmount * (consistencyPercent / 100);
        const remainingProfit = payoutAmount - bestDay;
        const remainingDays = minTradingDays - 1;
        const otherDaysDaily =
          remainingDays > 0 ? remainingProfit / remainingDays : 0;

        const bestDayPercent = (bestDay / accountSize) * 100;
        const otherDaysPercent = (otherDaysDaily / accountSize) * 100;
        const daysSaved = Math.max(0, payoutCycle - minTradingDays);
        const daysSavedPercent =
          payoutCycle > 0 ? (daysSaved / payoutCycle) * 100 : 0;

        // Update UI
        document.getElementById("bestDayProfit").textContent =
          "$" + bestDay.toFixed(2);
        document.getElementById("bestDayPercent").textContent =
          bestDayPercent.toFixed(3) + "% of account";
        document.getElementById("bestDayProfitPercent").textContent =
          consistencyPercent + "% of profit";

        document.getElementById("otherDaysProfit").textContent =
          "$" + otherDaysDaily.toFixed(2);
        document.getElementById("otherDaysPercent").textContent =
          otherDaysPercent.toFixed(3) + "% of account";
        document.getElementById("otherDaysProfitPercent").textContent =
          100 - consistencyPercent + "% of profit";

        document.getElementById("aggressiveTradingDays").textContent =
          minTradingDays;
        document.getElementById("aggressiveDaysPercent").textContent =
          ((minTradingDays / payoutCycle) * 100).toFixed(1) + "% of cycle";

        document.getElementById("daysSaved").textContent = daysSaved;
        document.getElementById("daysSavedPercent").textContent =
          daysSavedPercent.toFixed(1) + "% faster";

        // Summary
        const summary = `
                <div class="flex justify-between">
                    <span>Mode:</span>
                    <span class="font-semibold text-blue-400">Aggressive (Fast)</span>
                </div>
                <div class="flex justify-between">
                    <span>Best Day:</span>
                    <span class="font-semibold">$${bestDay.toFixed(2)}</span>
                </div>
                <div class="flex justify-between">
                    <span>Other ${remainingDays} Days:</span>
                    <span class="font-semibold">$${otherDaysDaily.toFixed(
                      2
                    )}/day</span>
                </div>
                <div class="flex justify-between">
                    <span>Complete In:</span>
                    <span class="font-semibold">${minTradingDays} days</span>
                </div>
                <div class="flex justify-between">
                    <span>Consistency Check:</span>
                    <span class="font-semibold text-green-400">‚úì Pass (${consistencyPercent}%)</span>
                </div>
                <div class="flex justify-between">
                    <span>Total Payout:</span>
                    <span class="font-semibold text-green-400">$${payoutAmount.toFixed(
                      2
                    )}</span>
                </div>
            `;
        document.getElementById("summaryContent").innerHTML = summary;

        // Draw chart
        drawPieChart(
          minTradingDays,
          bestDay,
          otherDaysDaily,
          accountSize,
          "AGGRESSIVE"
        );
      }

      function drawPieChart(
        totalDays,
        firstDayValue,
        otherDaysValue,
        accountSize,
        mode
      ) {
        const canvas = document.getElementById("projectionChart");
        const ctx = canvas.getContext("2d");
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const outerRadius = 130;
        const innerRadius = 80;

        // Clear canvas
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Colors
        const firstDayColor = mode === "NORMAL" ? "#20bf6b" : "#20bf6b";
        const otherColors = [
          "#3498db",
          "#e74c3c",
          "#f39c12",
          "#9b59b6",
          "#1abc9c",
          "#34495e",
          "#16a085",
          "#e67e22",
          "#2ecc71",
          "#95a5a6",
        ];

        // Draw segments
        const anglePerDay = (2 * Math.PI) / totalDays;
        let currentAngle = -0.5 * Math.PI;

        // First day
        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        ctx.arc(
          centerX,
          centerY,
          outerRadius,
          currentAngle,
          currentAngle + anglePerDay
        );
        ctx.closePath();
        ctx.fillStyle = firstDayColor;
        ctx.fill();
        ctx.strokeStyle = "#0a0a0a";
        ctx.lineWidth = 2;
        ctx.stroke();
        currentAngle += anglePerDay;

        // Other days
        for (let i = 1; i < totalDays; i++) {
          ctx.beginPath();
          ctx.moveTo(centerX, centerY);
          ctx.arc(
            centerX,
            centerY,
            outerRadius,
            currentAngle,
            currentAngle + anglePerDay
          );
          ctx.closePath();
          ctx.fillStyle = otherColors[i % otherColors.length];
          ctx.fill();
          ctx.strokeStyle = "#0a0a0a";
          ctx.lineWidth = 2;
          ctx.stroke();
          currentAngle += anglePerDay;
        }

        // Inner circle
        ctx.beginPath();
        ctx.arc(centerX, centerY, innerRadius, 0, 2 * Math.PI);
        ctx.fillStyle = "rgba(13, 17, 23, 0.95)";
        ctx.fill();
        ctx.strokeStyle = "#30363d";
        ctx.lineWidth = 3;
        ctx.stroke();

        // Center text
        ctx.fillStyle = "#20bf6b";
        ctx.font = "bold 18px Arial";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText(
          "$" + (accountSize / 1000).toFixed(0) + "K",
          centerX,
          centerY - 15
        );

        ctx.fillStyle = mode === "NORMAL" ? "#20bf6b" : "#3498db";
        ctx.font = "bold 20px Arial";
        ctx.fillText(mode, centerX, centerY + 15);

        // Legend
        const legendY = centerY + outerRadius + 30;
        ctx.fillStyle = firstDayColor;
        ctx.fillRect(centerX - 80, legendY, 15, 15);
        ctx.fillStyle = "#e0e0e0";
        ctx.font = "12px Arial";
        ctx.textAlign = "left";
        ctx.fillText(
          mode === "NORMAL" ? "Each Day" : "Best Day",
          centerX - 60,
          legendY + 12
        );

        if (mode === "AGGRESSIVE" && totalDays > 1) {
          ctx.fillStyle = otherColors[0];
          ctx.fillRect(centerX + 20, legendY, 15, 15);
          ctx.fillStyle = "#e0e0e0";
          ctx.fillText("Other Days", centerX + 40, legendY + 12);
        }
      }
    </script>
  </body>
</html>
