<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Trading Checklist & Journal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background: linear-gradient(
          135deg,
          #0a0a0a 0%,
          #1a1a1a 50%,
          #0a0a0a 100%
        );
        min-height: 100vh;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial,
          sans-serif;
      }

      .glass {
        background: rgba(13, 17, 23, 0.7);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(48, 54, 61, 0.5);
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
      }

      .glass-light {
        background: rgba(22, 27, 34, 0.6);
        backdrop-filter: blur(8px);
        border: 1px solid rgba(48, 54, 61, 0.3);
      }

      input[type="number"]::-webkit-outer-spin-button,
      input[type="number"]::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }

      input[type="number"] {
        -moz-appearance: textfield;
      }

      /* Calendar date input styling */
      input[type="date"] {
        color-scheme: dark;
      }

      input[type="date"]::-webkit-calendar-picker-indicator {
        filter: invert(0.5) grayscale(1);
        cursor: pointer;
        opacity: 0.7;
      }

      input[type="date"]::-webkit-calendar-picker-indicator:hover {
        opacity: 1;
      }

      .checkbox-custom {
        appearance: none;
        width: 20px;
        height: 20px;
        border: 2px solid #30363d;
        border-radius: 4px;
        background: rgba(13, 17, 23, 0.5);
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .checkbox-custom:checked {
        background: #20bf6b;
        border-color: #20bf6b;
      }

      .checkbox-custom:checked::after {
        content: "✓";
        display: block;
        color: #000;
        font-size: 14px;
        font-weight: bold;
        text-align: center;
        line-height: 16px;
      }

      .profit-row {
        background: rgba(32, 191, 107, 0.1) !important;
        border-left: 3px solid #20bf6b !important;
      }

      .loss-row {
        background: rgba(239, 68, 68, 0.1) !important;
        border-left: 3px solid #ef4444 !important;
      }

      .scrollbar-custom::-webkit-scrollbar {
        width: 8px;
      }

      .scrollbar-custom::-webkit-scrollbar-track {
        background: rgba(13, 17, 23, 0.5);
        border-radius: 4px;
      }

      .scrollbar-custom::-webkit-scrollbar-thumb {
        background: rgba(48, 54, 61, 0.8);
        border-radius: 4px;
      }

      .scrollbar-custom::-webkit-scrollbar-thumb:hover {
        background: rgba(48, 54, 61, 1);
      }

      .btn-primary {
        background: linear-gradient(135deg, #20bf6b 0%, #1a9957 100%);
        transition: all 0.3s ease;
      }

      .btn-primary:hover {
        background: linear-gradient(135deg, #1a9957 0%, #20bf6b 100%);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(32, 191, 107, 0.3);
      }

      .btn-danger {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        transition: all 0.3s ease;
      }

      .btn-danger:hover {
        background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
      }

      .date-divider {
        background: linear-gradient(
          90deg,
          transparent,
          rgba(32, 191, 107, 0.3),
          transparent
        );
        padding: 8px;
        margin: 12px 0;
        text-align: center;
        color: #20bf6b;
        font-weight: 600;
        font-size: 14px;
        border-radius: 4px;
      }

      /* Desktop: Fixed height with independent scrollbars */
      @media (min-width: 769px) {
        .left-column {
          height: calc(100vh - 200px);
          overflow-y: auto;
        }

        .right-column {
          height: calc(100vh - 200px);
          overflow-y: auto;
        }
      }

      /* Mobile: Natural flow, no scrollbars */
      @media (max-width: 768px) {
        .desktop-layout {
          flex-direction: column !important;
        }

        .left-column,
        .right-column {
          height: auto !important;
          overflow-y: visible !important;
        }
      }
    </style>
  </head>
  <body class="p-4 md:p-6">
    <div class="max-w-[1600px] mx-auto">
      <header class="glass rounded-xl p-6 mb-6">
        <div class="flex justify-between items-start">
          <div>
            <h1
              class="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-emerald-500"
            >
              Trading Checklist & Journal
            </h1>
            <p class="text-gray-400 mt-2">
              Track your setups and trading performance
            </p>
          </div>
          <a
            href="consistency_calculator.html"
            target="_blank"
            class="btn-primary text-white px-4 py-2 rounded-lg text-sm font-semibold flex items-center gap-2 hover:scale-105 transition-transform"
          >
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"
              ></path>
            </svg>
            Consistency Calculator
          </a>
        </div>
      </header>

      <div class="desktop-layout flex gap-6 flex-col md:flex-row">
        <!-- LEFT SIDE: CHECKLIST & PIE CHART -->
        <div class="w-full md:w-1/2 left-column scrollbar-custom space-y-6">
          <!-- Checklist Section -->
          <div class="glass rounded-xl p-6">
            <div class="flex justify-between items-center mb-6">
              <h2 class="text-2xl font-bold text-green-400">Setup Checklist</h2>
              <button
                onclick="resetChecklist()"
                class="btn-danger text-white px-4 py-2 rounded-lg text-sm font-semibold"
              >
                Reset
              </button>
            </div>

            <div class="space-y-6">
              <!-- TIME-BASED VOLUMES -->
              <div class="glass-light rounded-lg p-4">
                <div class="space-y-3">
                  <label class="flex items-start gap-3 cursor-pointer group">
                    <input
                      type="checkbox"
                      class="checkbox-custom mt-1 regular-check"
                      data-index="0"
                      onchange="updateChecklist()"
                    />
                    <span
                      class="text-gray-300 group-hover:text-green-400 transition-colors"
                      >Fair Value Gap identified</span
                    >
                  </label>
                  <label class="flex items-start gap-3 cursor-pointer group">
                    <input
                      type="checkbox"
                      class="checkbox-custom mt-1 regular-check"
                      data-index="1"
                      onchange="updateChecklist()"
                    />
                    <span
                      class="text-gray-300 group-hover:text-green-400 transition-colors"
                      >Low identified around or inside the FVG</span
                    >
                  </label>
                </div>
              </div>

              <!-- Sweep Confirmation -->
              <div class="glass-light rounded-lg p-4">
                <h3 class="text-l font-semibold text-green-300 mb-2">
                  Sweep Confirmation
                </h3>
                <p class="text-xs text-gray-400 mb-4">
                  (both can't be selected)
                </p>
                <div class="space-y-3">
                  <label class="flex items-start gap-3 cursor-pointer group">
                    <input
                      type="checkbox"
                      class="checkbox-custom mt-1 sweep-option"
                      data-index="2"
                      onchange="handleSweepSelection(0)"
                    />
                    <span
                      class="text-gray-300 group-hover:text-green-400 transition-colors"
                      >Sweeps low and closes green</span
                    >
                  </label>
                  <div class="text-center text-gray-500 text-sm font-bold">
                    OR
                  </div>
                  <label class="flex items-start gap-3 cursor-pointer group">
                    <input
                      type="checkbox"
                      class="checkbox-custom mt-1 sweep-option"
                      data-index="2"
                      onchange="handleSweepSelection(1)"
                    />
                    <span
                      class="text-gray-300 group-hover:text-green-400 transition-colors"
                      >Sweeps high and closes red</span
                    >
                  </label>
                </div>
              </div>

              <!-- Entry & TP/SL -->
              <div class="glass-light rounded-lg p-4">
                <div class="space-y-3">
                  <label class="flex items-start gap-3 cursor-pointer group">
                    <input
                      type="checkbox"
                      class="checkbox-custom mt-1 regular-check"
                      data-index="3"
                      onchange="updateChecklist()"
                    />
                    <span
                      class="text-gray-300 group-hover:text-green-400 transition-colors"
                      >Entry placed at sweep candle close</span
                    >
                  </label>
                  <label class="flex items-start gap-3 cursor-pointer group">
                    <input
                      type="checkbox"
                      class="checkbox-custom mt-1 regular-check"
                      data-index="4"
                      onchange="updateChecklist()"
                    />
                    <span
                      class="text-gray-300 group-hover:text-green-400 transition-colors"
                      >TP/SL based on standard deviation, the target should be
                      1:2</span
                    >
                  </label>
                </div>
              </div>

              <!-- Invalidation Rule -->
              <div class="glass-light rounded-lg p-4 border-l-4 border-red-500">
                <h3 class="text-lg font-semibold text-red-400 mb-3">
                  Invalidation Rule
                </h3>
                <p class="text-gray-300 text-sm">
                  The sweep candle goes beyond the first candle of the FVG
                  (Setup Invalid)
                </p>
              </div>
            </div>
          </div>

          <!-- Pie Chart -->
          <div class="glass rounded-xl p-6">
            <h2 class="text-2xl font-bold text-green-400 mb-4">
              Checklist Progress
            </h2>
            <div class="flex justify-center">
              <canvas id="pieChart" width="250" height="250"></canvas>
            </div>
            <div class="mt-4 text-center">
              <span class="text-2xl font-bold text-green-400" id="progressText"
                >0/5</span
              >
              <span class="text-gray-400 ml-2">items completed</span>
            </div>
          </div>
        </div>

        <!-- RIGHT SIDE: TRADING JOURNAL -->
        <div class="w-full md:w-1/2 right-column scrollbar-custom">
          <div class="glass rounded-xl p-6 h-full flex flex-col">
            <div class="flex justify-between items-center mb-6">
              <h2 class="text-2xl font-bold text-green-400">Trading Journal</h2>
              <div class="flex gap-3">
                <button
                  onclick="downloadJournal()"
                  class="btn-primary text-white px-4 py-2 rounded-lg text-sm font-semibold"
                >
                  Download Journal
                </button>
                <button
                  onclick="resetJournal()"
                  class="btn-danger text-white px-4 py-2 rounded-lg text-sm font-semibold"
                >
                  Reset
                </button>
              </div>
            </div>

            <!-- Input Form -->
            <form
              id="journalForm"
              class="glass-light rounded-lg p-4 space-y-4 mb-6"
            >
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-300 mb-2"
                    >Date</label
                  >
                  <input
                    type="date"
                    id="tradeDate"
                    required
                    class="w-full bg-black bg-opacity-50 border border-gray-700 rounded-lg px-4 py-2 text-gray-200 focus:outline-none focus:border-green-500 transition-colors"
                  />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-300 mb-2"
                    >Direction</label
                  >
                  <select
                    id="direction"
                    required
                    class="w-full bg-black bg-opacity-50 border border-gray-700 rounded-lg px-4 py-2 text-gray-200 focus:outline-none focus:border-green-500 transition-colors"
                  >
                    <option value="Long">Long ↑</option>
                    <option value="Short">Short ↓</option>
                  </select>
                </div>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-300 mb-2"
                  >Symbol</label
                >
                <input
                  type="text"
                  id="symbol"
                  required
                  placeholder="e.g., XAU/USD"
                  class="w-full bg-black bg-opacity-50 border border-gray-700 rounded-lg px-4 py-2 text-gray-200 focus:outline-none focus:border-green-500 transition-colors"
                />
              </div>

              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-300 mb-2"
                    >Entry</label
                  >
                  <input
                    type="number"
                    id="entry"
                    required
                    step="0.0000001"
                    placeholder="0.00"
                    class="w-full bg-black bg-opacity-50 border border-gray-700 rounded-lg px-4 py-2 text-gray-200 focus:outline-none focus:border-green-500 transition-colors"
                  />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-300 mb-2"
                    >Stop Loss</label
                  >
                  <input
                    type="number"
                    id="stoploss"
                    required
                    step="0.0000001"
                    placeholder="0.00"
                    class="w-full bg-black bg-opacity-50 border border-gray-700 rounded-lg px-4 py-2 text-gray-200 focus:outline-none focus:border-green-500 transition-colors"
                  />
                </div>
              </div>

              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-300 mb-2"
                    >Target</label
                  >
                  <input
                    type="number"
                    id="target"
                    required
                    step="0.0000001"
                    placeholder="0.00"
                    class="w-full bg-black bg-opacity-50 border border-gray-700 rounded-lg px-4 py-2 text-gray-200 focus:outline-none focus:border-green-500 transition-colors"
                  />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-300 mb-2"
                    >Exit</label
                  >
                  <input
                    type="number"
                    id="exit"
                    required
                    step="0.0000001"
                    placeholder="0.00"
                    class="w-full bg-black bg-opacity-50 border border-gray-700 rounded-lg px-4 py-2 text-gray-200 focus:outline-none focus:border-green-500 transition-colors"
                  />
                </div>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-300 mb-2"
                  >Profit/Loss</label
                >
                <select
                  id="profitLoss"
                  required
                  class="w-full bg-black bg-opacity-50 border border-gray-700 rounded-lg px-4 py-2 text-gray-200 focus:outline-none focus:border-green-500 transition-colors"
                >
                  <option value="Profit">Profit</option>
                  <option value="Loss">Loss</option>
                </select>
              </div>

              <button
                type="submit"
                class="w-full btn-primary text-white py-3 rounded-lg font-semibold text-lg"
              >
                Add Trade
              </button>
            </form>

            <!-- Trades List -->
            <div class="flex-1">
              <div id="tradesList"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Initialize data from localStorage
      let checklistState = JSON.parse(
        localStorage.getItem("checklistState")
      ) || {
        checks: [false, false, false, false, false], // 4 regular + 1 sweep (mutually exclusive)
      };

      let trades = JSON.parse(localStorage.getItem("trades")) || [];

      // Set today's date as default
      document.getElementById("tradeDate").valueAsDate = new Date();

      // Load checklist state
      function loadChecklistState() {
        const allCheckboxes = document.querySelectorAll(".checkbox-custom");

        allCheckboxes.forEach((cb) => {
          const index = parseInt(cb.getAttribute("data-index"));
          if (!isNaN(index) && checklistState.checks[index]) {
            cb.checked = true;
          }
        });

        updatePieChart();
      }

      // Handle sweep selection (mutual exclusion)
      function handleSweepSelection(optionIndex) {
        const sweepOptions = document.querySelectorAll(".sweep-option");
        const currentCheckbox = sweepOptions[optionIndex];
        const otherCheckbox = sweepOptions[optionIndex === 0 ? 1 : 0];

        if (currentCheckbox.checked) {
          // Uncheck the other option
          otherCheckbox.checked = false;
          checklistState.checks[2] = true; // Sweep confirmed (only one slot for both options)
        } else {
          checklistState.checks[2] = false; // No sweep selected
        }

        localStorage.setItem("checklistState", JSON.stringify(checklistState));
        updatePieChart();
      }

      // Update checklist state
      function updateChecklist() {
        const regularChecks = document.querySelectorAll(".regular-check");

        // Store all regular checks at their respective indices
        regularChecks.forEach((cb) => {
          const index = parseInt(cb.getAttribute("data-index"));
          if (!isNaN(index)) {
            checklistState.checks[index] = cb.checked;
          }
        });

        localStorage.setItem("checklistState", JSON.stringify(checklistState));
        updatePieChart();
      }

      // Reset checklist
      function resetChecklist() {
        if (confirm("Are you sure you want to reset the checklist?")) {
          checklistState = { checks: [false, false, false, false, false] };
          localStorage.setItem(
            "checklistState",
            JSON.stringify(checklistState)
          );

          const allCheckboxes = document.querySelectorAll(".checkbox-custom");
          allCheckboxes.forEach((cb) => (cb.checked = false));

          updatePieChart();
        }
      }

      // Update pie chart
      function updatePieChart() {
        const canvas = document.getElementById("pieChart");
        const ctx = canvas.getContext("2d");
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const radius = 100;

        // Count checked items (total 5: 4 regular + 1 sweep)
        const checkedCount = checklistState.checks.filter((c) => c).length;
        const totalCount = 5;
        const percentage = checkedCount / totalCount;

        // Clear canvas
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Draw background circle
        ctx.beginPath();
        ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
        ctx.fillStyle = "rgba(48, 54, 61, 0.3)";
        ctx.fill();
        ctx.strokeStyle = "rgba(48, 54, 61, 0.5)";
        ctx.lineWidth = 2;
        ctx.stroke();

        // Draw completed portion
        if (checkedCount > 0) {
          ctx.beginPath();
          ctx.moveTo(centerX, centerY);
          ctx.arc(
            centerX,
            centerY,
            radius,
            -0.5 * Math.PI,
            (-0.5 + 2 * percentage) * Math.PI
          );
          ctx.closePath();

          // Gradient for completed portion
          const gradient = ctx.createRadialGradient(
            centerX,
            centerY,
            0,
            centerX,
            centerY,
            radius
          );
          gradient.addColorStop(0, "#20bf6b");
          gradient.addColorStop(1, "#1a9957");
          ctx.fillStyle = gradient;
          ctx.fill();

          ctx.strokeStyle = "#20bf6b";
          ctx.lineWidth = 2;
          ctx.stroke();
        }

        // Draw center circle (donut effect)
        ctx.beginPath();
        ctx.arc(centerX, centerY, radius * 0.6, 0, 2 * Math.PI);
        ctx.fillStyle = "rgba(13, 17, 23, 0.9)";
        ctx.fill();

        // Draw percentage text
        ctx.font = "bold 32px Arial";
        ctx.fillStyle = "#20bf6b";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText(Math.round(percentage * 100) + "%", centerX, centerY);

        // Update progress text
        document.getElementById(
          "progressText"
        ).textContent = `${checkedCount}/${totalCount}`;
      }

      // Add trade
      document
        .getElementById("journalForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const trade = {
            id: Date.now(),
            date: document.getElementById("tradeDate").value,
            direction: document.getElementById("direction").value,
            symbol: document.getElementById("symbol").value.toUpperCase(),
            entry: parseFloat(document.getElementById("entry").value),
            stoploss: parseFloat(document.getElementById("stoploss").value),
            target: parseFloat(document.getElementById("target").value),
            exit: parseFloat(document.getElementById("exit").value),
            profitLoss: document.getElementById("profitLoss").value,
          };

          trades.push(trade);
          localStorage.setItem("trades", JSON.stringify(trades));

          // Reset form
          this.reset();
          document.getElementById("tradeDate").valueAsDate = new Date();

          renderTrades();
        });

      // Render trades with date dividers
      function renderTrades() {
        const tradesList = document.getElementById("tradesList");

        if (trades.length === 0) {
          tradesList.innerHTML =
            '<div class="text-center text-gray-500 py-8">No trades recorded yet</div>';
          return;
        }

        // Sort trades by date (newest first)
        const sortedTrades = [...trades].sort(
          (a, b) => new Date(b.date) - new Date(a.date)
        );

        // Group by date
        const groupedTrades = {};
        sortedTrades.forEach((trade) => {
          if (!groupedTrades[trade.date]) {
            groupedTrades[trade.date] = [];
          }
          groupedTrades[trade.date].push(trade);
        });

        let html = "";
        Object.keys(groupedTrades).forEach((date) => {
          // Date divider
          const dateObj = new Date(date + "T00:00:00");
          const formattedDate = dateObj.toLocaleDateString("en-US", {
            weekday: "short",
            year: "numeric",
            month: "short",
            day: "numeric",
          });
          html += `<div class="date-divider">${formattedDate}</div>`;

          // Trades for this date
          groupedTrades[date].forEach((trade) => {
            const rowClass =
              trade.profitLoss === "Profit" ? "profit-row" : "loss-row";
            const arrow = trade.direction === "Long" ? "↑" : "↓";
            const pnl =
              (trade.exit - trade.entry) *
              (trade.direction === "Long" ? 1 : -1);
            const riskReward = Math.abs(
              (trade.target - trade.entry) / (trade.entry - trade.stoploss)
            ).toFixed(2);

            html += `
                        <div class="glass-light rounded-lg p-4 mb-3 ${rowClass} transition-all hover:scale-[1.01]">
                            <div class="flex justify-between items-start mb-3">
                                <div class="flex items-center gap-2">
                                    <span class="text-2xl">${arrow}</span>
                                    <span class="text-xl font-bold text-gray-200">${
                                      trade.symbol
                                    }</span>
                                    <span class="text-sm text-gray-400">${
                                      trade.direction
                                    }</span>
                                </div>
                                <button onclick="deleteTrade(${
                                  trade.id
                                })" class="text-red-400 hover:text-red-300 transition-colors">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="grid grid-cols-2 gap-3 text-sm">
                                <div>
                                    <span class="text-gray-400">Entry:</span>
                                    <span class="text-gray-200 font-semibold ml-2">${
                                      trade.entry
                                    }</span>
                                </div>
                                <div>
                                    <span class="text-gray-400">Exit:</span>
                                    <span class="text-gray-200 font-semibold ml-2">${
                                      trade.exit
                                    }</span>
                                </div>
                                <div>
                                    <span class="text-gray-400">Stop Loss:</span>
                                    <span class="text-gray-200 font-semibold ml-2">${
                                      trade.stoploss
                                    }</span>
                                </div>
                                <div>
                                    <span class="text-gray-400">Target:</span>
                                    <span class="text-gray-200 font-semibold ml-2">${
                                      trade.target
                                    }</span>
                                </div>
                                <div>
                                    <span class="text-gray-400">P&L:</span>
                                    <span class="${
                                      trade.profitLoss === "Profit"
                                        ? "text-green-400"
                                        : "text-red-400"
                                    } font-bold ml-2">
                                        ${pnl.toFixed(7)} (${trade.profitLoss})
                                    </span>
                                </div>
                                <div>
                                    <span class="text-gray-400">R:R:</span>
                                    <span class="text-gray-200 font-semibold ml-2">1:${riskReward}</span>
                                </div>
                            </div>
                        </div>
                    `;
          });
        });

        tradesList.innerHTML = html;
      }

      // Delete trade
      function deleteTrade(id) {
        if (confirm("Delete this trade?")) {
          trades = trades.filter((t) => t.id !== id);
          localStorage.setItem("trades", JSON.stringify(trades));
          renderTrades();
        }
      }

      // Reset journal
      function resetJournal() {
        if (
          confirm(
            "Are you sure you want to delete all trades? This cannot be undone."
          )
        ) {
          trades = [];
          localStorage.setItem("trades", JSON.stringify(trades));
          renderTrades();
        }
      }

      // Download journal as JSON
      function downloadJournal() {
        if (trades.length === 0) {
          alert("No trades to download!");
          return;
        }

        const dataStr = JSON.stringify(trades, null, 2);
        const dataBlob = new Blob([dataStr], { type: "application/json" });
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement("a");
        link.href = url;
        link.download = `trading-journal-${
          new Date().toISOString().split("T")[0]
        }.json`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
      }

      // Initialize on load
      loadChecklistState();
      renderTrades();
    </script>
  </body>
</html>
